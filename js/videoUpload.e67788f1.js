(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["videoUpload"],{"17f9":function(e,t,r){"use strict";r.d(t,"e",(function(){return o})),r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return c})),r.d(t,"h",(function(){return s})),r.d(t,"d",(function(){return u})),r.d(t,"f",(function(){return l})),r.d(t,"i",(function(){return i})),r.d(t,"c",(function(){return d})),r.d(t,"g",(function(){return p}));var n=r("b32d"),o=function(e){return Object(n["a"])({method:"post",url:"/boss/course/getQueryCourses",data:e})},a=function(e){return Object(n["a"])({method:"get",url:"boss/course/changeState",params:e})},c=function(e){return Object(n["a"])({method:"post",url:"/boss/course/upload",data:e})},s=function(e){return Object(n["a"])({method:"post",url:"/boss/course/saveOrUpdateCourse",data:e})},u=function(e){return Object(n["a"])({method:"get",url:"/boss/course/getCourseById",params:{courseId:e}})},l=function(e){return Object(n["a"])({method:"get",url:"/boss/course/section/getSectionAndLesson",params:{courseId:e}})},i=function(e){return Object(n["a"])({method:"post",url:"/boss/course/section/saveOrUpdateSection",data:e})},d=function(e){return Object(n["a"])({method:"get",url:"/boss/course/section/getBySectionId",params:{sectionId:e}})},p=function(e){return Object(n["a"])({method:"post",url:"/boss/course/lesson/saveOrUpdate",data:e})}},"1f26":function(e,t,r){"use strict";r.r(t);var n=r("7a23"),o={class:"main-container"},a=Object(n["createTextVNode"])(" 添加视频 "),c={type:"file",ref:"videoRef"},s={style:{height:"20px",display:"flex"}},u={key:0,style:{"word-break":"keep-all"}},l={type:"file",ref:"fileRef"},i={style:{height:"20px",display:"flex"}},d={key:0,style:{"word-break":"keep-all"}},p={style:{height:"20px",display:"flex","padding-top":"10px"}},f={key:0,style:{"word-break":"keep-all"}},b={key:2},m=Object(n["createTextVNode"])("开始上传"),O=Object(n["createTextVNode"])("返回");function j(e,t,r,j,v,g){var h=Object(n["resolveComponent"])("ArrowLeftOutlined"),N=Object(n["resolveComponent"])("a-divider"),y=Object(n["resolveComponent"])("a-input"),C=Object(n["resolveComponent"])("a-form-item"),k=Object(n["resolveComponent"])("a-progress"),w=Object(n["resolveComponent"])("a-button"),I=Object(n["resolveComponent"])("a-form"),x=Object(n["resolveComponent"])("a-card");return Object(n["openBlock"])(),Object(n["createElementBlock"])("section",o,[Object(n["createVNode"])(x,{bordered:!1},{title:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("span",{style:{cursor:"pointer"},onClick:t[0]||(t[0]=function(t){return e.$router.back()})},[Object(n["createVNode"])(h)]),Object(n["createVNode"])(N,{type:"vertical"}),a]})),default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(I,{ref:"formRef","label-col":e.labelCol,"wrapper-col":e.wrapperCol,model:e.formState},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(C,{label:"课程名称",required:""},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(y,{value:e.formState.courseName,"onUpdate:value":t[1]||(t[1]=function(t){return e.formState.courseName=t}),disabled:""},null,8,["value"])]})),_:1}),Object(n["createVNode"])(C,{label:"章节名称",required:""},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(y,{value:e.formState.sectionName,"onUpdate:value":t[2]||(t[2]=function(t){return e.formState.sectionName=t}),disabled:""},null,8,["value"])]})),_:1}),Object(n["createVNode"])(C,{label:"视频上传"},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("input",c,null,512),Object(n["createElementVNode"])("div",s,[e.videoProgress?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",u,"视频上传进度：")):Object(n["createCommentVNode"])("",!0),e.videoProgress?(Object(n["openBlock"])(),Object(n["createBlock"])(k,{key:1,status:"active",percent:e.videoProgress,size:"small"},null,8,["percent"])):Object(n["createCommentVNode"])("",!0)])]})),_:1}),Object(n["createVNode"])(C,{label:"封面上传"},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("input",l,null,512),Object(n["createElementVNode"])("div",i,[e.imageProgress?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",d,"文件上传进度：")):Object(n["createCommentVNode"])("",!0),e.imageProgress?(Object(n["openBlock"])(),Object(n["createBlock"])(k,{key:1,status:"active",percent:e.imageProgress,size:"small"},null,8,["percent"])):Object(n["createCommentVNode"])("",!0)])]})),_:1}),Object(n["createVNode"])(C,{"wrapper-col":{span:14,offset:4}},{default:Object(n["withCtx"])((function(){return[Object(n["createElementVNode"])("div",p,[e.transCodeProgress?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",f,"转码进度：")):Object(n["createCommentVNode"])("",!0),e.transCodeProgress&&e.transCodeProgress<100?(Object(n["openBlock"])(),Object(n["createBlock"])(k,{key:1,status:"active",percent:e.transCodeProgress,size:"small"},null,8,["percent"])):Object(n["createCommentVNode"])("",!0),100===e.transCodeProgress?(Object(n["openBlock"])(),Object(n["createElementBlock"])("span",b,"已完成")):Object(n["createCommentVNode"])("",!0)])]})),_:1}),Object(n["createVNode"])(C,{"wrapper-col":{span:14,offset:4}},{default:Object(n["withCtx"])((function(){return[Object(n["createVNode"])(w,{type:"primary",onClick:e.handlerUpload},{default:Object(n["withCtx"])((function(){return[m]})),_:1},8,["onClick"]),Object(n["createVNode"])(N,{type:"vertical"}),Object(n["createVNode"])(w,{onClick:t[3]||(t[3]=function(t){return e.$router.back()})},{default:Object(n["withCtx"])((function(){return[O]})),_:1})]})),_:1})]})),_:1},8,["label-col","wrapper-col","model"])]})),_:1})])}var v=r("5530"),g=(r("380f"),r("f64c")),h=r("1da1"),N=(r("96cf"),r("a9e3"),r("b0c0"),r("1cd4")),y=r("b32d"),C=function(){return Object(y["a"])({method:"get",url:"/boss/course/upload/aliyunImagUploadAddressAdnAuth.json"})},k=function(e){return Object(y["a"])({method:"get",url:"/boss/course/upload/aliyunVideoUploadAddressAdnAuth.json",params:e})},w=function(e){return Object(y["a"])({method:"post",url:"/boss/course/upload/aliyunTransCode.json",data:e})},I=function(e){return Object(y["a"])({method:"post",url:"/boss/course/upload/aliyunTransCodePercent.json",params:{lessonId:e}})},x=r("17f9"),V=r("6c02"),U=Object(n["defineComponent"])({name:"VideoUpload",components:{ArrowLeftOutlined:N["a"]},props:{courseId:{type:String,required:!0}},setup:function(e){var t=Object(n["ref"])(),r=Object(n["ref"])(),o=Object(n["ref"])(),a=Object(n["reactive"])({formState:Object(n["ref"])({courseName:"",sectionName:""}),uploader:null,imageUrl:"",videoId:"",imageProgress:0,videoProgress:0,transCodeProgress:0}),c=Object(V["c"])(),s=function(){var t=Object(h["a"])(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(x["d"])(Number(e.courseId));case 3:r=t.sent,n=r.data,"000000"===n.code&&(a.formState.courseName=n.data.courseName),t.next=10;break;case 8:t.prev=8,t.t0=t["catch"](0);case 10:case"end":return t.stop()}}),t,null,[[0,8]])})));return function(){return t.apply(this,arguments)}}(),u=function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(x["c"])(Number(c.query.sectionId));case 3:t=e.sent,r=t.data,"000000"===r.code&&(a.formState.sectionName=r.data.sectionName),e.next=10;break;case 8:e.prev=8,e.t0=e["catch"](0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),l=function(){a.uploader=new window.AliyunUpload.Vod({userId:"1618139964448548",partSize:1048576,parallel:5,retryCount:3,retryDuration:2,enableUploadProgress:!0,onUploadstarted:function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(t){var r,n,o,c,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("onUploadstarted"),!t.isImage){e.next=9;break}return e.next=4,C();case 4:n=e.sent,o=n.data,"000000"===o.code&&(a.imageUrl=o.data.imageURL,r=o.data),e.next=14;break;case 9:return e.next=11,k({fileName:t.file.name,imageUrl:a.imageUrl});case 11:c=e.sent,s=c.data,"000000"===s.code&&(r=s.data,a.videoId=r.videoId);case 14:a.uploader.setUploadAuthAndAddress(t,r.uploadAuth,r.uploadAddress,r.imageId||r.videoId);case 16:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),onUploadSucceed:function(e){console.log("onUploadSucceed")},onUploadFailed:function(e,t,r){console.log("onUploadFailed: ",r)},onUploadProgress:function(e,t,r){console.log("onUploadProgress: ",Math.ceil(100*r)+"%"),e.isImage?a.imageProgress=Math.ceil(100*r):a.videoProgress=Math.ceil(100*r)},onUploadTokenExpired:function(e){console.log("onUploadTokenExpired")},onUploadEnd:function(){var e=Object(h["a"])(regeneratorRuntime.mark((function e(t){var n,o,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("onUploadEnd: uploaded all the files",t),!r.value){e.next=11;break}return e.next=4,w({lessonId:Number(c.query.lessonId),coverImageUrl:a.imageUrl,fileId:a.videoId,fileName:r.value.files[0].name});case 4:return n=e.sent,o=n.data,console.log("视频转码: ",o),e.next=9,setInterval(Object(h["a"])(regeneratorRuntime.mark((function e(){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,I(Number(c.query.lessonId));case 2:t=e.sent,r=t.data,"000000"===r.code&&(a.transCodeProgress=r.data,100===r.data&&(console.log("转码成功"),clearInterval(s)));case 5:case"end":return e.stop()}}),e)}))),1e4);case 9:s=e.sent,g["a"].success("视频上传成功啦");case 11:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()})},i=function(){var e,t;if(!o.value.files)return g["a"].warning("请上传封面");if(!r.value.files)return g["a"].warning("请上传视频");var n=null===(e=r.value)||void 0===e?void 0:e.files[0],c=null===(t=o.value)||void 0===t?void 0:t.files[0],s=a.uploader;s.addFile(c,null,null,null,'{ "Vod": {}}'),s.addFile(n,null,null,null,'{ "Vod": {}}'),s.startUpload()};return Object(v["a"])(Object(v["a"])({formRef:t},Object(n["toRefs"])(a)),{},{labelCol:{span:4},wrapperCol:{span:14},loadCourseById:s,loadSectionById:u,videoRef:r,fileRef:o,initUploader:l,handlerUpload:i})},created:function(){this.initUploader(),this.loadCourseById(),this.loadSectionById()}}),E=(r("eacf"),r("6b0d")),S=r.n(E);const A=S()(U,[["render",j],["__scopeId","data-v-5ad4aaa4"]]);t["default"]=A},"408a":function(e,t,r){var n=r("e330");e.exports=n(1..valueOf)},5899:function(e,t){e.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(e,t,r){var n=r("e330"),o=r("1d80"),a=r("577e"),c=r("5899"),s=n("".replace),u="["+c+"]",l=RegExp("^"+u+u+"*"),i=RegExp(u+u+"*$"),d=function(e){return function(t){var r=a(o(t));return 1&e&&(r=s(r,l,"")),2&e&&(r=s(r,i,"")),r}};e.exports={start:d(1),end:d(2),trim:d(3)}},7156:function(e,t,r){var n=r("1626"),o=r("861d"),a=r("d2bb");e.exports=function(e,t,r){var c,s;return a&&n(c=t.constructor)&&c!==r&&o(s=c.prototype)&&s!==r.prototype&&a(e,s),e}},"903b":function(e,t,r){},a9e3:function(e,t,r){"use strict";var n=r("83ab"),o=r("da84"),a=r("e330"),c=r("94ca"),s=r("6eeb"),u=r("1a2d"),l=r("7156"),i=r("3a9b"),d=r("d9b5"),p=r("c04e"),f=r("d039"),b=r("241c").f,m=r("06cf").f,O=r("9bf2").f,j=r("408a"),v=r("58a8").trim,g="Number",h=o[g],N=h.prototype,y=o.TypeError,C=a("".slice),k=a("".charCodeAt),w=function(e){var t=p(e,"number");return"bigint"==typeof t?t:I(t)},I=function(e){var t,r,n,o,a,c,s,u,l=p(e,"number");if(d(l))throw y("Cannot convert a Symbol value to a number");if("string"==typeof l&&l.length>2)if(l=v(l),t=k(l,0),43===t||45===t){if(r=k(l,2),88===r||120===r)return NaN}else if(48===t){switch(k(l,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+l}for(a=C(l,2),c=a.length,s=0;s<c;s++)if(u=k(a,s),u<48||u>o)return NaN;return parseInt(a,n)}return+l};if(c(g,!h(" 0o1")||!h("0b1")||h("+0x1"))){for(var x,V=function(e){var t=arguments.length<1?0:h(w(e)),r=this;return i(N,r)&&f((function(){j(r)}))?l(Object(t),r,V):t},U=n?b(h):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),E=0;U.length>E;E++)u(h,x=U[E])&&!u(V,x)&&O(V,x,m(h,x));V.prototype=N,N.constructor=V,s(o,g,V)}},eacf:function(e,t,r){"use strict";r("903b")}}]);
//# sourceMappingURL=videoUpload.e67788f1.js.map